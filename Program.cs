// Program.cs  (.NET 9)

// ??????????????????????????????
//  USING DIRECTIVES
// ??????????????????????????????
using Airlines_Services_ML_Approachs.Models;
using Airlines_Services_ML_Approachs.Services;
using Microsoft.AspNetCore.Builder;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.OpenApi.Models;

// ??????????????????????????????
//  BUILD & CONFIGURE SERVICES
// ??????????????????????????????
var builder = WebApplication.CreateBuilder(args);

// Flight?delay prediction singleton
builder.Services.AddSingleton<DelayPredictionService>();

// MVC / Controllers support (optional but handy)
builder.Services.AddControllers();

// Swagger / OpenAPI
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen(c =>
{
    c.SwaggerDoc("v1", new OpenApiInfo
    {
        Title = "Flight Delay Predictor",
        Version = "v1"
    });
});

// ??????????????????????????????
//  BUILD APP PIPELINE
// ??????????????????????????????
var app = builder.Build();

// Swagger middleware
app.UseSwagger();
app.UseSwaggerUI();

// Redirect root to Swagger UI   ?  GET https://localhost:####/  shows docs
app.MapGet("/", () => Results.Redirect("/swagger"));

// Minimal?API endpoint
app.MapPost("/predict",
    (FlightData input, DelayPredictionService service) =>
        Results.Ok(service.Predict(input)));

// Optional: Map controllers (if you add any)
app.MapControllers();

// ??????????????????????????????
app.Run();
